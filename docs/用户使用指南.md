# Tiny Blog 用户使用指南

欢迎使用 Tiny Blog！这份指南将帮助你快速上手博客的配置、内容管理和日常使用。

## 📋 目录

- [快速开始](#快速开始)
- [管理后台使用](#管理后台使用)
- [部署后配置](#部署后配置)
- [内容管理](#内容管理)
- [博客编辑与发布](#博客编辑与发布)
- [高级配置](#高级配置)
- [常见问题](#常见问题)
- [故障排查](#故障排查)

## 🚀 快速开始

### 部署完成后的首次配置

1. **访问你的博客**
   ```
   http://localhost:3131
   ```
   (或你在部署时指定的端口)

2. **确认服务状态**
   ```bash
   # 查看容器状态
   docker compose ps
   
   # 查看日志
   docker compose logs -f
   ```

3. **验证数据目录结构**
   ```
   blog-data/
   ├── content/
   │   ├── posts/          # 你的文章将存储在这里
   │   ├── pages/          # 关于页面等静态页面
   │   └── images/         # 图片资源
   └── config/
       └── site.config.json # 站点配置文件
   ```

## 🛡️ 管理后台使用

### 访问管理后台

1. **获取安全入口码**
   部署完成后，终端会显示生成的8位安全入口码，请妥善保存：
   ```
   🔐 安全信息:
     • 安全入口码: ABC12345
   ```

2. **访问管理界面**
   ```
   http://localhost:3131/admin?key=你的8位安全入口码
   ```

   > ⚠️ **注意：** 管理后台仅支持PC端访问，移动设备将被自动限制。

### 管理后台功能

#### 📝 文章管理
- **创建新文章**: 点击"新建文章"按钮，使用在线Markdown编辑器
- **编辑现有文章**: 在文章列表中点击编辑按钮
- **实时预览**: 编辑器支持双栏模式，左侧编辑，右侧实时预览
- **发布控制**: 可以设置文章为草稿或发布状态

#### 🖼️ 媒体管理
- **图片上传**: 支持拖拽上传或点击选择文件
- **图片预览**: 缩略图展示所有已上传的图片
- **图片删除**: 一键删除不需要的图片资源
- **路径复制**: 快速复制图片路径用于文章中引用

#### ⚙️ 站点设置
- **基本信息**: 修改博客标题、描述、作者信息
- **社交链接**: 配置GitHub、Twitter、邮箱等链接
- **显示设置**: 调整每页文章数量、摘要长度等
- **安全设置**: 修改安全入口码（建议定期更换）

#### 📄 页面管理
- **关于我页面**: 编辑个人介绍内容
- **关于博客页面**: 编辑博客说明信息
- **Markdown支持**: 所有页面都支持Markdown格式

### 认证与安全

- **JWT认证**: 登录后会获得JWT token，自动管理会话
- **会话续期**: Token会自动刷新，保持登录状态
- **安全退出**: 点击右上角头像可以安全退出登录
- **权限控制**: 所有管理功能都需要admin权限验证

## ⚙️ 部署后配置

### 1. 个性化站点信息

编辑 `blog-data/config/site.config.json` 文件：

```json
{
  "title": "我的博客",
  "description": "这是我的个人技术博客",
  "author": {
    "name": "你的名字",
    "email": "your@email.com",
    "github": "github-username",
    "bio": "简短的个人介绍"
  },
  "url": "https://yourdomain.com",
  "social": {
    "github": "https://github.com/username",
    "twitter": "https://twitter.com/username",
    "email": "contact@example.com"
  },
  "theme": {
    "primaryColor": "#000000",
    "accentColor": "#666666"
  },
  "seo": {
    "keywords": ["技术", "编程", "前端", "博客"],
    "googleAnalytics": "GA_TRACKING_ID"
  },
  "secureEntrance": "ABC12345",
  "postsPerPage": 6,
  "excerptLength": 200
}
```

> 💡 **提示：** `secureEntrance` 是管理后台的安全入口码，建议定期更换以确保安全。

### 2. 配置热重载

修改配置后，可以通过 API 重新加载配置：

```bash
curl -X POST http://localhost:3131/api/config/reload \
  -H "Authorization: Bearer YOUR_REVALIDATE_SECRET" \
  -H "Content-Type: application/json"
```

或者重启容器：
```bash
docker compose restart
```

### 3. 自定义关于页面

编辑 `blog-data/content/pages/about-me.md`：

```markdown
---
title: "关于我"
---

# 关于我

这里是你的个人介绍...

## 技能

- 前端开发
- 后端开发
- 数据库设计

## 经历

- 2023-至今：软件工程师
- 2021-2023：前端开发工程师
```

## 📝 内容管理

### 文章结构

每篇文章都是一个 Markdown 文件，包含 frontmatter 和正文内容：

```markdown
---
title: "文章标题"
date: "2024-01-01"
tags: ["技术", "前端", "React"]
description: "文章摘要，用于SEO和文章列表展示"
cover: "/images/article-cover.jpg"
published: true
author: "作者名称"
---

# 文章标题

这里是文章的正文内容...

## 章节标题

文章内容支持所有 Markdown 语法。

### 代码块示例

```javascript
function hello() {
    console.log("Hello, World!");
}
```

### 图片插入

![图片描述](/images/example.jpg)
```

### Frontmatter 字段说明

| 字段 | 类型 | 必填 | 说明 |
|------|------|------|------|
| `title` | string | ✅ | 文章标题 |
| `date` | string | ✅ | 发布日期 (YYYY-MM-DD) |
| `tags` | array | ❌ | 标签数组 |
| `description` | string | ❌ | 文章摘要 |
| `cover` | string | ❌ | 封面图片路径 |
| `published` | boolean | ❌ | 是否发布 (默认 true) |
| `author` | string | ❌ | 作者名称 |
| `category` | string | ❌ | 文章分类 |
| `lastModified` | string | ❌ | 最后修改时间 |

### 目录结构建议

```
blog-data/content/posts/
├── 2024-01-01-hello-world.md
├── 2024-01-15-react-best-practices.md
├── 2024-02-01-typescript-guide.md
└── drafts/                    # 草稿文件夹
    └── work-in-progress.md
```

## ✍️ 博客编辑与发布

### 1. 创建新文章

```bash
# 进入文章目录
cd blog-data/content/posts/

# 创建新文章
touch 2024-08-17-my-new-article.md
```

使用任何文本编辑器编辑文章：

```bash
# 使用 vim
vim 2024-08-17-my-new-article.md

# 使用 VS Code
code 2024-08-17-my-new-article.md

# 使用 nano
nano 2024-08-17-my-new-article.md
```

### 2. 文章模板

创建一个文章模板 `blog-data/content/posts/_template.md`：

```markdown
---
title: "文章标题"
date: "2024-08-17"
tags: ["标签1", "标签2"]
description: "文章摘要"
cover: "/images/cover.jpg"
published: false
---

# 文章标题

## 介绍

简短介绍文章内容...

## 主要内容

### 小节标题

具体内容...

## 总结

文章总结...

---

**参考资料:**
- [链接1](https://example.com)
- [链接2](https://example.com)
```

### 3. 图片管理

**上传图片：**

1. 将图片放入 `blog-data/content/images/` 目录
2. 建议按年月组织：`blog-data/content/images/2024/08/`
3. 在文章中引用：`![描述](/images/2024/08/image.jpg)`

**图片优化建议：**
- 使用 WebP 格式以获得更好的压缩率
- 图片宽度建议不超过 1200px
- 为每张图片添加有意义的 alt 文本

### 4. 发布流程

1. **编写文章**
   ```markdown
   ---
   published: false  # 草稿状态
   ---
   ```

2. **预览检查**
   - 访问博客首页查看文章列表
   - 点击文章标题预览内容
   - 检查格式、图片、链接等

3. **正式发布**
   ```markdown
   ---
   published: true   # 发布状态
   ---
   ```

4. **立即生效**
   - 保存文件后，刷新浏览器即可看到更新
   - 无需重启服务或重新构建

### 5. 标签管理

**标签最佳实践：**
- 使用一致的标签命名（建议中文或英文，保持统一）
- 每篇文章 3-5 个标签比较合适
- 定期整理和规范标签

**查看所有标签：**
访问 `http://localhost:3131/tags` 查看标签云。

## 🔧 高级配置

### 1. 自定义域名

如果你有自己的域名，需要：

1. **更新配置文件**
   ```json
   {
     "url": "https://yourdomain.com"
   }
   ```

2. **更新环境变量**
   ```bash
   # 编辑 .env 文件
   SITE_URL=https://yourdomain.com
   ```

3. **重启服务**
   ```bash
   docker compose restart
   ```

### 2. 备份数据

**定期备份重要数据：**

```bash
# 备份整个数据目录
tar -czf blog-backup-$(date +%Y%m%d).tar.gz blog-data/

# 只备份内容
tar -czf content-backup-$(date +%Y%m%d).tar.gz blog-data/content/

# 同步到远程服务器
rsync -av blog-data/ user@server:/backup/blog-data/
```

### 3. 性能优化

**图片优化：**
```bash
# 批量压缩图片（需要安装 imagemagick）
cd blog-data/content/images/
find . -name "*.jpg" -exec mogrify -quality 85 {} \;
```

**内容清理：**
```bash
# 清理未使用的图片
# 删除过时的草稿文件
```

### 4. SEO 优化

1. **配置 Google Analytics**
   ```json
   {
     "seo": {
       "googleAnalytics": "GA_TRACKING_ID"
     }
   }
   ```

2. **优化文章 SEO**
   - 使用有意义的文件名
   - 填写准确的 description
   - 使用合适的标签
   - 添加适当的内部链接

## ❓ 常见问题

### Q1: 文章修改后不生效怎么办？

**A1:** 
1. 确认文件已保存
2. 检查 Markdown 语法是否正确
3. 查看浏览器控制台是否有错误
4. 刷新页面（Ctrl+F5 强制刷新）

### Q2: 图片显示不出来怎么办？

**A2:**
1. 检查图片路径是否正确（以 `/images/` 开头）
2. 确认图片文件存在于 `blog-data/content/images/` 目录
3. 检查图片文件权限
4. 尝试不同的图片格式（jpg, png, webp）

### Q3: 如何批量导入文章？

**A3:**
1. 准备好符合格式的 Markdown 文件
2. 将文件放入 `blog-data/content/posts/` 目录
3. 确保每个文件都有正确的 frontmatter
4. 刷新页面查看结果

### Q4: 如何修改博客主题颜色？

**A4:**
1. 编辑 `blog-data/config/site.config.json`
2. 修改 `theme` 部分的颜色设置
3. 重新加载配置或重启服务

### Q5: 如何设置文章密码保护？

**A5:**
目前版本不支持密码保护，可以通过以下方式实现：
1. 将敏感文章设置为 `published: false`
2. 使用外部认证服务
3. 升级到支持认证的版本

### 🆕 Q6: 管理后台无法访问怎么办？

**A6:**
1. **检查安全入口码**：确认使用的是正确的8位安全入口码
2. **检查URL格式**：确保URL格式为 `http://localhost:3131/admin?key=你的安全入口码`
3. **清除浏览器缓存**：清除Cookie和本地存储
4. **检查设备类型**：管理后台仅支持PC端访问，移动设备会被拒绝
5. **重新部署**：如果问题持续存在，可能需要重新部署

### 🆕 Q7: 管理后台登录后立即退出？

**A7:**
1. **检查Cookie设置**：确保浏览器允许第三方Cookie
2. **检查网络连接**：确保网络稳定，API请求正常
3. **刷新页面**：有时token验证需要刷新页面
4. **重新登录**：清除本地存储后重新输入安全入口码登录

### 🆕 Q8: 如何修改安全入口码？

**A8:**
1. **通过管理后台修改**：在设置页面中修改secureEntrance字段
2. **手动修改配置文件**：编辑 `blog-data/config/site.config.json` 中的secureEntrance字段
3. **重新部署生成**：删除配置文件重新部署会自动生成新的安全入口码
4. **建议定期更换**：为了安全考虑，建议每3-6个月更换一次

### 🆕 Q9: 上传的图片无法显示？

**A9:**
1. **检查文件格式**：确保上传的是支持的图片格式（jpg, png, gif, webp等）
2. **检查文件大小**：大文件可能上传失败，建议图片小于2MB
3. **检查存储路径**：确认图片已正确保存到 `content/images/` 目录
4. **刷新缓存**：清除浏览器缓存后重新访问

## 🔧 故障排查

### 服务无法启动

**检查步骤：**

1. **查看容器状态**
   ```bash
   docker compose ps
   docker compose logs blog
   ```

2. **检查端口占用**
   ```bash
   lsof -i :3131
   netstat -tlnp | grep 3131
   ```

3. **检查磁盘空间**
   ```bash
   df -h
   ```

4. **重启服务**
   ```bash
   docker compose down
   docker compose up -d
   ```

### 文章列表为空

**可能原因和解决方法：**

1. **检查文件权限**
   ```bash
   ls -la blog-data/content/posts/
   ```

2. **检查文件格式**
   - 确保文件扩展名是 `.md`
   - 检查 frontmatter 格式是否正确

3. **查看 API 响应**
   ```bash
   curl http://localhost:3131/api/posts
   ```

### 配置修改不生效

**解决步骤：**

1. **检查 JSON 格式**
   ```bash
   # 验证 JSON 格式
   cat blog-data/config/site.config.json | jq .
   ```

2. **手动重载配置**
   ```bash
   curl -X POST http://localhost:3131/api/config/reload \
     -H "Authorization: Bearer YOUR_SECRET"
   ```

3. **重启容器**
   ```bash
   docker compose restart
   ```

### 性能问题

**优化建议：**

1. **检查资源使用**
   ```bash
   docker stats tiny-blog
   ```

2. **清理日志**
   ```bash
   docker compose logs --tail=100 blog
   ```

3. **优化图片**
   - 压缩图片大小
   - 使用适当的图片格式
   - 减少单页图片数量

### 获取帮助

如果遇到其他问题：

1. **查看官方文档**：README.md
2. **检查日志文件**：`docker compose logs`
3. **GitHub Issues**：在项目仓库创建 Issue
4. **社区支持**：查找相关技术社区

---

## 🎉 恭喜！

你已经掌握了 Tiny Blog 的基本使用方法。开始创作你的第一篇博客文章吧！

记住：
- 📝 定期备份你的内容
- 🔄 保持系统更新
- 🎨 个性化你的博客配置
- 📊 关注博客的性能和访问量

愿你的博客之旅愉快！ ✨